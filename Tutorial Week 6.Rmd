---
title: "Rural Windfall or a New Resource Curse? Coca, Income, and Civil Conflict in Colombia"
subtitle: "Based on Angrist & Kugler (2008)"
author:
  - Maximilian Birkle
  - Daniel Lehmann
  - Henry Lucas
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: true
    toc_depth: 2
    number_sections: true
    fig_caption: true
    keep_tex: false
    latex_engine: xelatex
  github_document:
    toc: true
    html_preview: true
---

```{r setup, include=TRUE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, 
                      fig.width = 10, fig.height = 6)
# Setup 
if (!require(haven)) install.packages("haven")
library (haven)
if (!require(dplyr)) install.packages("dplyr")
library(dplyr)
if (!require(foreign)) install.packages("foreign")
library(foreign)
if (!require(plm)) install.packages("plm")
library(plm)
if (!require(stargazer)) install.packages("stargazer")
library(stargazer)
if (!require(ggplot2)) install.packages("ggplot2")
library (ggplot2)
if (!require(sandwich)) install.packages("sandwich")
library (sandwich)
if (!require(lmtest)) install.packages("lmtest")
library (lmtest)
if (!require(tidyverse)) install.packages("tidyverse")
library (tidyverse)
if (!require(BART)) install.packages("BART")
library (BART)
if (!require(grf)) install.packages("grf")
library (grf)
if (!require(car)) install.packages("car")
library (car)


# Load Data and take a look at the dataset
dta <- read_delim("data00_AngristKugler.tab", delim = "\t")
```

---

# Q1. Setup and Data Construction

**Tasks:**

1. Create `grow` variable (1 if `dep_ocu` $\in \{13, 18, 19, 50, 52, 86, 95, 97, 99\}$, 0 otherwise)

```{r q1-data-setup}

# Creating a new variable grow
department_list <- c(13, 18, 19, 50, 52, 86, 95, 97, 99)

dta <- dta %>% 
  mutate(grow = ifelse(dep_ocu %in% department_list, 1, 0))
```

2. Subset data to years 1991, 1992, 1993 and 1996, 1997, 1998

```{r}

# Subsetting the dataset to years 1991 - 1993 and 1996 - 1998
dta_subset <- dta %>% 
  filter(year %in% c(1991, 1992, 1993, 1996, 1997, 1998))

```

3. Create `after` variable (1 if year $\in \{1996, 1997, 1998\}$, 0 otherwise)

```{r}

# We create a variable called after with 1 for years 1996 - 1998
dta_subset <- dta_subset %>% 
  mutate(after = ifelse(year %in% c(1996, 1997, 1998), 1, 0))
```

4. Create `growafter` variable (`grow` $\times$ `after`)

```{r}

# Creating growafter variable (grow * after)
dta_subset <- dta_subset %>% 
  mutate(growafter = grow * after)

dta_subset %>% 
  count(grow, after, growafter)
```

5. Create outcome variable: $\log\left(\frac{\text{populati}+1}{\text{violent}+1}\right)$

```{r}

# Create outcome variable

dta_subset <- dta_subset %>% 
  mutate(outcome = log((violent + 1) / (populati + 1)))
```

---

# Q2. Visualizing Violence Before and After

**Tasks:**

1. Create density plots for non-growing vs. growing regions, before vs. after
2. Extend to $2 \times 2$ grid by gender (men: `sex=1`, women: `sex=2`)
3. Interpret: Evidence of shifts in violence? Different by gender?

```{r q2-density-plots-simple}

# Density plots: Non-growing vs. Growing regions

density_plot <- dta_subset %>% 
  mutate(
    period = factor(after, levels = c(0, 1), labels = c("Before (1991-93)", "After (1996-98)")),
    region_type = factor(grow, levels = c(0, 1), labels = c("Non-Growing Region", "Growing Region")),
    gender = factor(sex, levels = c(1, 2), labels = c("Men", "Women"))
  )


density_plot %>%
  ggplot(aes(x = outcome, fill = period, color = period)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~ region_type) +
  labs(title = "Logged per-capita violent death rate distribution: Before vs After by Region Type",
       x = "Number of Violent Deaths",
       y = "Density") +
  theme_bw()

```

```{r q2-density-plots-gender}
# 2x2 grid: Top=men, Bottom=women; Left=non-growing, Right=growing

density_plot %>%
  filter(!is.na(gender)) %>%
  ggplot(aes(x = outcome, fill = period, color = period)) +
  geom_density(alpha = 0.5) +
  facet_grid(gender ~ region_type) +
  labs(title = "Logged per-capita violent death rate distribution by Gender and Region Type",
       x = "Number of Violent Deaths",
       y = "Density") +
  theme_bw()
```

**Interpretation:**

The evidence indicates a significant shift in violence following the air-bridge disruption, with the effect being highly specific to both region and gender. For the treatment group (**coca-growing regions**), there was a slight increase in the per-capita violent death rate among men. In contrast, the control group (**non-growing regions**) showed no meaningful change for either gender, which suggests that the increase in violence was not due to a nationwide trend. Furthermore, the pattern seems to be strongly gendered; the effect on women in the treatment group was minimal compared to a much larger effect on men. This suggests that the impact of the coca boom on violence was almost exclusively concentrated among the male population, who seem to have been the primary participants in the conflict.

---

# Q3. Age-Specific Effects

**Task:** For coca-growing regions only, plot the change in outcome (after - before) by age group.

```{r q3-age-effects}
# Calculate mean difference by age for growing regions only

age_effects <- dta_subset %>%
  filter(grow == 1) %>%
  group_by(age, after) %>%
  summarise(mean_outcome = mean(outcome, na.rm = TRUE), .groups = "drop") %>%
  pivot_wider(names_from = after, values_from = mean_outcome, names_prefix = "period_") %>%
  mutate(change = period_1 - period_0)

# Plot age-specific effects
age_effects %>%
  ggplot(aes(x = age, y = change)) +
  geom_line(color = "blue", size = 1) +
  geom_point(color = "blue", size = 2) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  labs(title = "Change in Logged per-capita Violent Death Rate by Age (Coca-Growing Regions)",
       x = "Age",
       y = "Change in Outcome (After - Before)") +
  theme_bw()

```

**Interpretation:**

This plot illustrates how the average violence rate changes for each age group by calculating the difference between the average violence rate for an age group after the air-bridge disruption and the average violence rate for that same group before the disruption. Clearly, the plot shows that the effect varies dramatically across different age groups, with a concentration in certain age brackets. The increase in conflict and violence seems to have disproportionately affected individuals of fighting age, as can be seen from the peaks in the graph between the ages of 17 and 22. Additionally, younger adolescents around the age of 10 seem to have been particularly involved in violent activities, resulting in a much higher death rate after the air disruption. However, it is important to note that, for a few age groups — especially those around 15 years old — the rate of violence decreased after the air disruption. 

This seemingly volatile distribution across age groups reveals a key insight. If the increase in violence was solely due to increased criminal activity, we would most likely see it concentrated among cohorts that met the age of fighting and above. However, since we cleary see that also much younger age groups show an increase in violent deaths, we can conclude that this is mostly caused by conflict-related violence (e.g. civil war) after the 'air bridge' intervention, which corresponds to the paper's findings. 

To explore this interesting trend, we created a graph for the per-capita violent death rate in coca-growing regions before and after for men only. What we can see here is that the increase in violence was not confined by the typical "fighting age" bracket but was high across the entire young male distribution, including children around 10. This pattern strongly suggests widespread, conflict-related violence. The coca boom fueled this by creating two distinct sets of victims: older cohorts were recruited as soldiers, while younger boys, drawn in as laborers, became collateral damage in the armed groups' fight to control the coca fields and labor force. The overall increased death rate of civillians may also have driven this trend.

```{r q3-men-age-effects}

age_effects_men <- dta_subset %>%
  filter(grow == 1, sex == 1) %>% 
  group_by(age, after) %>%
  summarise(
    mean_outcome = mean(outcome, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_wider(
    names_from = after,
    values_from = mean_outcome,
    names_prefix = "period_"
  ) %>%
  mutate(change = period_1 - period_0)

# Plot for age specific effects
age_effects_men %>%
  ggplot(aes(x = age, y = change)) +
  geom_line(color = "blue", size = 1) +
  geom_point(color = "blue", size = 2) +
  geom_hline(
    yintercept = 0,
    linetype = "dashed",
    color = "red"
  ) +
  labs(
    title = "Change in Logged per-capita Violent Death Rate by Age (Men in Coca-Growing Regions)", 
    x = "Age",
    y = "Change in Outcome (After - Before)"
  ) +
  theme_bw()
```


---

# Q4. Testing the Parallel Trends Assumption (Pre-Treatment)

**Tasks:**

1. Use pre-treatment years (1990-1993)
2. Estimate: outcome $= \alpha + \beta \cdot \text{year} + \gamma \cdot \text{grow} + \delta \cdot (\text{grow} \times \text{year}) + u$
3. Test if `grow` $\times$ `year` interactions are jointly zero (year as linear and categorical)
4. Create graph of average outcome by year and group

```{r q4-prepare-data}
# Subset to pre-treatment years (1990-1993)
dta_pretreatment <- dta %>%
  filter(year %in% c(1990, 1991, 1992, 1993)) %>%
  mutate(grow = ifelse(dep_ocu %in% department_list, 1, 0),
         outcome = log((violent + 1) / (populati + 1)))
```

```{r q4-parallel-trends-linear-categorical, results='asis'}
# Model with year as linear
year_linear <- lm(outcome ~ year + grow + year:grow, data = dta_pretreatment)

# Model with year as categorical (factor)
year_factor <- lm(outcome ~ factor(year) + grow + factor(year):grow, data = dta_pretreatment)

# Stargazer table for better visualization

# 1. Define the professional labels for your variables.
pro_labels <- c(
  "Coca-Growing Region",
  "Year (Linear) $\\times$ Growing Region",
  "1991 $\\times$ Growing Region",
  "1992 $\\times$ Growing Region",
  "1993 $\\times$ Growing Region",
  "Constant"
)

# 2. Run stargazer with new arguments
stargazer(
  year_linear, year_factor,
  type = "latex", 
  title = "Table 1: Pre-Treatment Parallel Trends Test",
  header = FALSE,
  column.labels = c("Linear Trend", "Categorical Trend"),
  dep.var.labels = "Logged Per-Capita Violent Death Rate",
  keep = c("grow", "year:grow", "factor\\(year\\)199[1-3]:grow", "Constant"),
  covariate.labels = pro_labels,
  no.space = TRUE,
  omit.stat = c("adj.rsq", "ser","rsq")
)

```

```{r q4-joint-test}
# Test if grow×year interactions are jointly zero
linearHypothesis(year_factor, matchCoefs(year_factor, ":grow"))
```

```{r q4-visual-trends}
# Graph: Average outcome by year and group
dta_pretreatment %>%
  group_by(year, grow) %>%
  summarise(mean_outcome = mean(outcome, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = year, y = mean_outcome, color = factor(grow))) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "Pre-treatment Trends in Violence by Region Type",
    subtitle = "Checking Parallel Trends (1990–1993)",
    x = "Year",
    y = "Mean Logged per-capita Violent Death Rate",
    color = "Coca-growing Region"
  ) +
  theme_bw()
```

**Interpretation:**

To assess the validity of the parallel trend assumption, we focused on the pre-treatment period from 1990 to 1993. Both regression models formally test this parallel trends assumption by examining if the pre-treatment trends in violence are statistically different between the coca-growing regions and non-growing regions. The first model simplifies our analysis by assuming that time follows a linear trend. The key coefficient here is the interaction term **year:grow**, which measures the difference in the slopes of trend lines for the two groups. The p-value for this term is 0.99, which indicates that there is no statistically significant difference between the slopes. 
The second model offers a more flexible, year-by-year analysis by checking if the gap in violence between the two groups changed in any year from 1991 to 1993 compared to the baseline year of 1990, instead of assuming a straight line. The additional, joint F-test on these interactions yields a p-value of 1 which is why we fail to reject the null hypothesis $H_0$ that the pre-treatment trends are perfectly parallel. This result is crucial because it validates the use of non-growing regions as a credible counterfactual. It gives us confidence that any divergence between the groups after the disruption is due to the coca boom itself, rather than pre-existing differences in trends.

---

# Q5. Placebo DiD Test 

**Tasks:**

1. Create `placebo_after` (1 if year $= 1992$ or $1993$, 0 if year $= 1990$ or $1991$)
2. Estimate placebo DiD model
3. Interpret `placebo_after` $\times$ `grow` coefficient

```{r q5-placebo-data}
# Subset and create placebo variables
dta_placebo <- dta %>%
  filter(year %in% c(1990, 1991, 1992, 1993)) %>%
  mutate(
    grow = ifelse(dep_ocu %in% department_list, 1, 0),
    outcome = log((violent + 1) / (populati + 1)),
    placebo_after = ifelse(year %in% c(1992, 1993), 1, 0)
  )
```

```{r q5-placebo-regression, results='asis'}
# Estimate placebo DiD model
placebo_did <- lm(outcome ~ placebo_after + grow + placebo_after:grow, data = dta_placebo)

# Create stargazer table
placebo_labels <- c(
  "Placebo 'After' (1992-93)",
  "Coca-Growing Region",
  "Placebo 'After' $\\times$ Growing Region",
  "Constant"
)

# Run stargazer
stargazer(
  placebo_did,
  type = "latex",
  title = "Table 2: Placebo Difference-in-Differences Test",
  header = FALSE,
  column.labels = "Placebo Model",
  dep.var.labels = "Logged Per-Capita Violent Death Rate",
  covariate.labels = placebo_labels,
  no.space = TRUE,
  omit.stat = c("adj.rsq", "ser", "f", "rsq")
)
```

**Interpretation:**

In general, the placebo test helps us to check the parallel trends assumption, stating that the outcome (violence) in the treatment group (coca-growing regions) and the control group (non-growing regions) would have developed the same way, had the treatment (air bridge disruption) not been applied. For that reason, we take only the data from the "before" period (1990-1993), when the real treatment (starting 1996) has not happened yet. Moreover, we invent a fake intervention that supposedly happened in the middle of this period and split the data in two halves. We run the same DiD regression using this subset of the data. As there is no treatment, at least that we know of, applied during that time, the interaction coefficient **placebo_after:grow** should not be significant. In other words, we do not want to reject the null hypothesis for this placebo test, as it assumes that in the pre-treatment period, there was no difference in the trend of violence between the coca-growing region and the non-growing regions. This serves as a form of "sanity check", to test the credibility of our main DiD analysis, specifically the underlying parallel trends assumption. A significant coefficient would, of course, suggest the opposite. Our results show this coefficient is -0.0031 and indeed not significant with a p-value of 0.977. This confirms our assumption that the two groups were trending parallel, giving us confidence that the significant effect we find later is due to the impact of treatment and not the product of some pre-existing trend.

---

# Q6. Covariate Balance at Time 0

**Task:** Compare treatment and control regions on `age`, `sex`, and `populati` using pre-treatment data.

```{r q6-balance-table}
# Create balance table
dta_balance <- dta_subset %>%
  filter(after == 0)

balance_table <- dta_balance %>%
  group_by(grow) %>%
  summarise(
    mean_age = mean(age, na.rm = TRUE),
    mean_sex = mean(sex, na.rm = TRUE),
    mean_pop = mean(populati, na.rm = TRUE),
    .groups = "drop"
  )

# Rename 'grow' for clarity before printing
balance_table <- balance_table %>%
  mutate(grow = ifelse(grow == 1, "Growing Region (Treat)", "Non-Growing Region (Control)"))

# Table Output 
knitr::kable(
  balance_table,
  caption = "Table 3: Covariate Balance in Pre-Treatment Period (Time 0)",
  col.names = c("Region Type", "Mean Age", "Mean Sex", "Mean Population"),
  digits = 2
)
```

**Interpretation:**

In the balance check, we check if the treatment and control groups looked similar before the treatment started, by grouping the pre-treatment data into treatment (growing regions) and control group (non-growing regions) and calculating the mean for the variables age, sex, and populati . This is critical for DiD validity because the entire method relies on the assumption that the control group serves as a valid counterfactual for the treatment group. If the groups already were different before the treatment, we couldn't be sure if a later change in violence was due to the treatment (the coca boom) or those pre-existing differences. This serves as a useful addition to the placebo test. While in the placebo test, we checked if trends in the outcome (violence) were already diverging before treatment , the balance check compares the average levels of group characteristics (like age or population) at the start, helping us to select a control group that is at least plausibly similar to the treatment group before the treatment. This is also the reason why the authors, unfortunately, do not compare the coca-growing regions in Colombia to Neckarstadt West, as the two groups would be widely imbalanced on various key characteristics, even if there were parallel trends in the outcome (logged per-capita violent death rate) before treatment application.
In our results , we can see that age is almost perfectly balanced (15.5 vs 15.6), and sex is mostly balanced (1.51 vs 1.59). Regarding populati, we see a large imbalance, where the treatment regions (40,541) are almost half as populated as the control regions (78,301). This strongly suggests that coca cultivation didn't just appear anywhere, but rather "selected into" areas that were already systematically more rural and less populated. Considering that large imbalance, we would have to worry about it, as we could not rule out the difference of being more rural as the real reason for a change in violence and not the treatment. However, looking at our previous tests, despite the imbalance, the trends in violence were parallel before the treatment . The authors try to address this issue, by making the groups more comparable. They drop the departments with the largest cities (like Bogota) from the control group in their main analysis. So by making groups slightly more comparable and having secured before that we have parallel trends before the treatment, we can still be confident in the analysis.

---

# Q7. Why Covariate Balance Matters

**Discussion Questions:**

1. If covariates are balanced at time 0, what does this imply about confounding?
*  If our covariates were perfectly balanced, it would imply that the selection into the treatment group was "as good as random". This would be the ideal case, as it would mean that there are no observed pre-existing differences (or confounders) that could offer an alternative explanation for our results. However, as we saw in our balance check , the groups are imbalanced on **populati**, which confirms that selection was not random and we must deal with these confounders.

2. What role do these variables play after assignment?
* Since our Q6 check showed that the groups are imbalanced (especially on **populati**), we can't just ignore these differences. Their role is to be control variables in our main DiD regression. By adding **age**, **sex**, and **populati** to the model, we are statistically "leveling the playing field." The regression "partials out" (or removes) the effect of these confounding variables, which "cleans" our DiD estimate. This allows us to adjust for the fact that the groups weren't identical to begin with, making our final after:grow coefficient much more credible.

3. If violence trends already differ before treatment, how might this bias DiD?
* This is the most critical threat to our entire study. If the violence trends were already different (e.g., if violence in coca regions was already increasing faster than in non-growing regions before 1996), our DiD model would be biased. The model would falsely attribute that pre-existing difference in trends to the "air bridge" disruption. This would completely mix up the "fake" trend effect with the "real" treatment effect, making our final coefficient meaningless. This is precisely why the Q4 and Q5 tests were so vital : they proved this wasn't happening, so we can be confident our DiD is not biased in this way.

---

# Q8. Covariate Timing and Post-Treatment Bias

**Discussion Questions:**

1. Should we include covariates from time 0, time 1, or both?
* For the sake of our difference-in-difference model, we should include the covariates measured at Time 0, as well as the time-invariant covariates that do not change over time (e.g. **sex**). The purpose of adding covariates in this context is to control for confounding factors. As we discovered in Question 6, the treatment (**grow** = 1) and control (**grow** = 0) groups were not identical at the outset, with the growing regions having much lower populations. This creates an issue, as we cannot determine whether the DiD effect is due to the coca boom or if rural regions with low populations simply have different violence trends naturally. By adding covariates such as **populati** from the baseline period (Time 0) to our regression model, we can statistically adjust for this pre-existing difference. The model essentially allows us to compare the groups as if they had started with the same population levels.

2. What happens if you include a covariate measured after treatment?
* Adding a covariate that is measured after the treatment could lead to severe problems. In this case, for example, the treatment (i.e. the coca boom) might have caused a change in the covariate, which in turn caused a change in the outcome (violence). Let us break this example down: First, we observe the coca boom happening. This boom might cause people to move to the region to find work, resulting in a change in the population at Time 1. This change in population could then lead to more violence. Therefore, this change in population is one of the mechanisms through which the coca boom affects violence, and is therefore part of the overall causal effect. However, by controlling for population in our model at Time 1, we block one of the main ways in which the treatment works, as we have instructed the model to disregard the fact that a significant aspect of the coca boom's impact was its effect on population change. This could lead to a serious underestimation of our causal effect. This issue is especially important in DiD frameworks, where post-treatment covariates can introduce what’s known as **post-treatment bias**, leading to highly biased estimates. 

3. When might adjusting for post-treatment variables be appropriate?
* If our main goal is to find the total causal effect of the treatment, it is almost never appropriate to adjust for such variables. One exception is if we are conducting a mediation analysis and deliberately change our research question from 'What is the total effect of the coca boom on violence?' to 'How much of the coca boom's effect on violence is explained by changes in region's population?'. In this specific case, we would run a regression with and without the post-treatment **populati** variable and compare the $\beta_3$ coefficients. The degree to which the coefficient shrinks after adding the population variable would be our estimate of the mediated effect. But since we are interested in the total causal effect, we must avoid using post-treatment variables as controls. 

---

# Q9. Computing the DiD Estimate

**Task:** Compute manual DiD estimate.

```{r q9-manual-did}
# Mean difference (after - before) for grow=1 and grow=0
did_table <- dta_subset %>%
  group_by(grow, after) %>%
  summarise(mean_outcome = mean(outcome, na.rm = TRUE), .groups = "drop") %>%
  pivot_wider(names_from = after, values_from = mean_outcome, names_prefix = "time") %>%
  mutate(diff = time1 - time0)

# DiD estimate: subtract the two
did_estimate <- diff(did_table$diff)
did_estimate

```

**Interpretation:**

The problem with a simple before-and-after comparison is that it is based on the flawed assumption that the only thing that changed for coca-growing regions between the 'before' and 'after' periods was the disruption to the air bridge. However, it is almost certain that other trends were at play during that time that could have caused changes in violence rates across the entire country, which were completely unrelated to the coca boom. For example, if violence was generally increasing across all of Colombia due to political instability or economic problems, a simple before-after comparison in the growing regions would wrongly attribute all of that increase to the coca boom, unable to distinguish between the effects of the treatment and those of other confounding trends occurring simultaneously.

By contrast, the difference-in-differences (DiD) estimate is superior because it uses non-growing regions (**grow** = 0) as a counterfactual to address this issue. The logic is that the difference between the 'after' and 'before' periods in the non-growing regions acts as a benchmark, essentially capturing the change in violence due to all those other nationwide factors. The difference in the growing regions, however, captures the same 'background trend' plus the true causal effect of the coca boom. By subtracting the control group's change from the treatment group's change, we can effectively control for the background trend, provided the crucial parallel trends assumption holds (which our Q4 and Q5 tests suggest it does ). This isolates the true causal effect.

---

# Q10. Regression Form of DiD

**Tasks:**

1. Estimate: outcome $= \beta_0 + \beta_1 \cdot \text{after} + \beta_2 \cdot \text{grow} + \beta_3 \cdot (\text{after} \times \text{grow}) + u$
2. Report $\beta_3$ and p-value
3. Show analytically that $\beta_3$ equals the manual DiD estimate

```{r q10-did-regression}
# DiD regression model
did <- lm(outcome ~ after + grow + after:grow, data = dta_subset)
summary(did)
```

**Interpretation:**
The $\beta_3$ coefficient of our interaction term **after:grow** is 0.19702 with a p-value of 0.0256. Since the p-value is less than 0.05, the effect is statistically significant, which means that the effect of 0.19072 is not just a random fluctuation. After controlling for pre-existing differences between the regions (**grow**) and for general time trends affecting all of Colombia (**after**), the air-bridge disruption caused a significant increase in the logged per-capita violent death rate of 0.197 in the coca growing regions. 

**Analytical proof:**
## Analytical Proof

We want to show that the coefficient $\beta_3$ from the regression equation is mathematically identical to the manual Difference-in-Differences calculation: $(\bar{Y}_{1,1} - \bar{Y}_{1,0}) - (\bar{Y}_{0,1} - \bar{Y}_{0,0})$.

The regression model is:
$$
\texttt{outcome} = \beta_0 + \beta_1\,\texttt{after} + \beta_2\,\texttt{grow} + \beta_3\,(\texttt{after}\times\texttt{grow}) + u
$$

We can find the expected value (the mean, $\bar{Y}$) for each of our four groups by plugging in 0s and 1s for the dummy variables.

1.  **Control Group (grow=0), Before (after=0):**
    $$
    \bar{Y}_{0,0} = \beta_0 + \beta_1(0) + \beta_2(0) + \beta_3(0 \times 0) = \boldsymbol{\beta_0}
    $$

2.  **Control Group (grow=0), After (after=1):**
    $$
    \bar{Y}_{0,1} = \beta_0 + \beta_1(1) + \beta_2(0) + \beta_3(1 \times 0) = \boldsymbol{\beta_0 + \beta_1}
    $$

3.  **Treatment Group (grow=1), Before (after=0):**
    $$
    \bar{Y}_{1,0} = \beta_0 + \beta_1(0) + \beta_2(1) + \beta_3(0 \times 1) = \boldsymbol{\beta_0 + \beta_2}
    $$

4.  **Treatment Group (grow=1), After (after=1):**
    $$
    \bar{Y}_{1,1} = \beta_0 + \beta_1(1) + \beta_2(1) + \beta_3(1 \times 1) = \boldsymbol{\beta_0 + \beta_1 + \beta_2 + \beta_3}
    $$

Now, we substitute these four equations into the manual DiD formula:

$$
DiD = (\bar{Y}_{1,1} - \bar{Y}_{1,0}) - (\bar{Y}_{0,1} - \bar{Y}_{0,0})
$$

We can use the `align*` environment to show the substitution and simplification clearly:

\begin{align*}
DiD &= \left[ (\beta_0 + \beta_1 + \beta_2 + \beta_3) - (\beta_0 + \beta_2) \right] - \left[ (\beta_0 + \beta_1) - (\beta_0) \right] \\
&= \left[ \beta_1 + \beta_3 \right] - \left[ \beta_1 \right] \\
&= \boldsymbol{\beta_3}
\end{align*}

This proves that the coefficient on the interaction term, $\beta_3$, is mathematically identical to the Difference-in-Differences estimate.

---

# Q11. Adding Covariates

**Task:** Estimate three models and compare.

```{r q11-model1}
# Model 1: outcome ~ grow + after + growafter
cov_did1 <- lm(outcome ~ after + grow + after:grow, data = dta_subset)
```

```{r q11-model2}
# Model 2: Add age and sex
cov_did2 <- lm(outcome ~ after + grow + after:grow + age + sex, data = dta_subset)
```

```{r q11-model3}
# Model 3: Add age, sex, and populati
cov_did3 <- lm(outcome ~ after + grow + after:grow + age + sex + populati, data = dta_subset)
```

```{r q11-comparison}
# Compare models
stargazer(cov_did1, cov_did2, cov_did3,      # List your models
          type = "text",                   # Output type: "text", "html", or "latex"
          title = "Regression Results: The Effect of Treatment on Outcome",
          align = TRUE,                    # Aligns numbers on decimal points
          dep.var.labels = "Outcome",      # A clean name for the dependent variable
          column.labels = c("Base Model", "Adds Demographics", "Full Model"),
          covariate.labels = c("After Treatment", "Treatment Group (Grow)", "Age",
                               "Sex", "Population", "Interaction: After x Grow"),
          notes = "Standard errors are in parentheses.",
          notes.align = "l")
```

**Discussion:**

[Does $\beta_3$ change? Do covariates matter? Which specification is most credible?]

---

# Q12. Interpretation and Reflection

**Summary:**

1. Did violence increase or decrease after the air-bridge disruption?
2. Does the evidence support a "resource-curse" interpretation?
3. What are the remaining identification threats?

[Your final interpretation here]
